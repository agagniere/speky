kind: tests
category: functional
tests:
- id: TMCP020
  ref: [MCP007]
  short: list_references_to returns referencing requirements
  long: Query which requirements reference a given requirement and verify the response
  prereq: [TMCP003]
  steps:
  - action: The client calls `list_references_to` with ID `RF04`, which is referenced by `RF03`
    sample_lang: json
    sample: |
      {
        "id": 2,
        "jsonrpc": "2.0",
        "method": "tools/call",
        "params": {
          "name": "list_references_to",
          "arguments": {"id": "RF04"}
        }
      }
  - action: Verify the response contains RF03
    sample_lang: json
    sample: |
      {
        "id": 2,
        "jsonrpc": "2.0",
        "result": {
          "structuredContent": {
            "requirements": [
              {
                "category": "non-functional",
                "id": "RF03",
                "short": "Number 3",
                "tags": ["foo", "bar:baz"]
              }
            ]
          }
        }
      }

- id: TMCP021
  ref: [MCP007]
  short: list_references_to returns empty list for unreferenced requirement
  long: Query which requirements reference a requirement that no other requirement points to, verify an empty list is returned
  prereq: [TMCP003]
  steps:
  - action: The client calls `list_references_to` with ID `RF01`, which no requirement references
    sample_lang: json
    sample: |
      {
        "id": 2,
        "jsonrpc": "2.0",
        "method": "tools/call",
        "params": {
          "name": "list_references_to",
          "arguments": {"id": "RF01"}
        }
      }
  - action: Verify an empty list is returned
    sample_lang: json
    sample: |
      {
        "id": 2,
        "jsonrpc": "2.0",
        "result": {
          "structuredContent": {
            "requirements": []
          }
        }
      }

- id: TMCP022
  ref: [MCP007]
  short: list_references_to errors on unknown ID
  long: |
    The user shall receive a tool execution error when calling list_references_to
    with an ID that does not exist in the loaded specifications.
  prereq: [TMCP003]
  steps:
  - action: The client calls `list_references_to` with a non-existent ID
    sample_lang: json
    sample: |
      {
        "id": 2,
        "jsonrpc": "2.0",
        "method": "tools/call",
        "params": {
          "name": "list_references_to",
          "arguments": {"id": "NOTFOUND"}
        }
      }
  - action: Verify a tool execution error is returned indicating the ID was not found
    sample_lang: json
    sample: |
      {
        "id": 2,
        "jsonrpc": "2.0",
        "result": {
          "isError": true,
          "structuredContent": {
            "error": "Requirement NOTFOUND not found"
          }
        }
      }
